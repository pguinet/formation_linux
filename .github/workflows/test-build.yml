name: ðŸ§ª Test PDF Build

on:
  pull_request:
    branches: [ master, main ]
    paths:
      - 'supports/**'
      - 'travaux_pratiques/**' 
      - 'scripts/**'
      - '.github/workflows/**'

jobs:
  test-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ðŸ› ï¸ Install LaTeX dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y pandoc texlive-latex-recommended texlive-lang-french
        
    - name: ðŸ“ Prepare build environment
      run: |
        mkdir -p build/modules_additionnels
        chmod +x scripts/*.sh
        
    - name: ðŸ§ª Test Git module build
      run: |
        echo "ðŸ§ª Testing Git module build..."
        timeout 300s ./scripts/build_git_module.sh || echo "âš ï¸ Git build test failed or timed out"
        
    - name: ðŸ§ª Test Docker module build  
      run: |
        echo "ðŸ§ª Testing Docker module build..."
        timeout 300s ./scripts/build_docker_module.sh || echo "âš ï¸ Docker build test failed or timed out"
        
    - name: ðŸ“Š Test results
      run: |
        echo "## ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ -f "build/modules_additionnels/module_additionnel_git.pdf" ]; then
          echo "âœ… Git module build: Success" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ Git module build: Failed" >> $GITHUB_STEP_SUMMARY
        fi
        
        if [ -f "build/modules_additionnels/module_additionnel_docker.pdf" ]; then
          echo "âœ… Docker module build: Success" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ Docker module build: Failed" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ’¡ **Note:** This is a test build for PR validation. No artifacts are published." >> $GITHUB_STEP_SUMMARY